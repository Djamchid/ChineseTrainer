<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Calligraphy Practice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f7f3e9;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #d62828;
            margin-bottom: 10px;
        }
        
        p {
            margin-bottom: 20px;
            color: #666;
        }
        
        .game-section {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        
        .character-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .character-display {
            font-size: 120px;
            margin: 20px 0;
            font-weight: 400;
            color: #333;
            line-height: 1;
            min-height: 150px;
            font-family: 'KaiTi', 'SimKai', 'STKaiti', sans-serif;
        }
        
        .pinyin-display {
            font-size: 24px;
            margin-bottom: 5px;
            color: #666;
        }
        
        .meaning-display {
            font-size: 18px;
            margin-bottom: 20px;
            color: #888;
            font-style: italic;
        }
        
        .drawing-area {
            position: relative;
            width: 300px;
            height: 300px;
            border: 2px solid #ccc;
            margin: 0 auto 20px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="20" height="20" fill="none" stroke="%23eee" stroke-width="0.5"/></svg>');
            background-size: 20px 20px;
        }
        
        .canvas-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 300px;
            height: 300px;
            opacity: 0.2;
            pointer-events: none;
            z-index: 1;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            z-index: 2;
        }
        
        .drawing-section {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 15px;
        }
        
        .right-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 120px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 0;
        }
        
        button {
            padding: 10px 20px;
            background-color: #f77f00;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            width: 100%;
            text-align: center;
        }
        
        button:hover {
            background-color: #e76f00;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        #clearBtn {
            background-color: #666;
        }
        
        #clearBtn:hover {
            background-color: #555;
        }
        
        .settings {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        select {
            padding: 8px;
            margin-left: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        
        .progress-container {
            width: 100%;
            background-color: #eee;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #4caf50;
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .streak-counter {
            font-size: 16px;
            color: #4caf50;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .character-guide {
            position: relative;
            margin: 10px 0;
        }
        
        .examples-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .example-character {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .example-character:hover {
            background-color: #f0f0f0;
        }
        
        .example-character span:first-child {
            font-size: 36px;
            font-family: 'KaiTi', 'SimKai', 'STKaiti', sans-serif;
        }
        
        .example-character span:last-child {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .stroke-order-btn {
            background-color: #3a86ff;
            margin-left: 10px;
        }
        
        .stroke-order-btn:hover {
            background-color: #2a76ef;
        }
        
        .pronounce-btn {
            background-color: #4CAF50;
            margin-left: 10px;
        }
        
        .pronounce-btn:hover {
            background-color: #3d8b40;
        }
        
        .hint-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto;
            display: none;
        }
        
        @media (max-width: 600px) {
            .character-display {
                font-size: 100px;
            }
            
            .drawing-area, .canvas-overlay, canvas {
                width: 250px;
                height: 250px;
            }
            
            .hint-container {
                width: 250px;
                height: 250px;
            }
            
            .game-section {
                flex-direction: column;
            }
            
            .drawing-section {
                flex-direction: row;
                align-items: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chinese Calligraphy Practice</h1>
        <p>Practice writing common Chinese characters. Draw the displayed character in the box below.</p>
        
        <div class="streak-counter">Current streak: <span id="streak">0</span></div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="game-section">
            <div class="character-container">
                <div class="pinyin-display" id="pinyin"></div>
                <div class="character-display" id="character"></div>
                <div class="meaning-display" id="meaning"></div>
                
                <div class="controls">
                    <button id="showHintBtn" class="stroke-order-btn">Show Hint</button>
                    <button id="hideHintBtn" class="stroke-order-btn" style="display:none;">Hide Hint</button>
                    <button id="pronounceBtn" class="pronounce-btn"><i class="fas fa-volume-up"></i> Pronounce</button>
                </div>
                
                <div class="hint-container" id="hintContainer">
                    <div class="character-display" style="opacity: 0.3;"></div>
                </div>
            </div>
            
            <div class="drawing-section">
                <div class="drawing-area">
                    <canvas id="canvas" width="300" height="300"></canvas>
                </div>
                
                <div class="right-controls">
                    <button id="clearBtn">Clear</button>
                    <button id="nextBtn">Next Character</button>
                </div>
            </div>
        </div>
        
        <div class="settings">
            <label for="level">Difficulty Level:</label>
            <select id="level">
                <option value="beginner">Beginner (HSK 1)</option>
                <option value="elementary">Elementary (HSK 2)</option>
                <option value="intermediate">Intermediate (HSK 3)</option>
                <option value="advanced">Advanced (HSK 4-6)</option>
            </select>
        </div>
        
        <div class="examples-container" id="examplesContainer">
            <!-- Examples will be added here -->
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Canvas setup
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d', { willReadFrequently: true });
            const characterDisplay = document.getElementById('character');
            const pinyinDisplay = document.getElementById('pinyin');
            const meaningDisplay = document.getElementById('meaning');
            const clearBtn = document.getElementById('clearBtn');
            const nextBtn = document.getElementById('nextBtn');
            const levelSelect = document.getElementById('level');
            const progressBar = document.getElementById('progressBar');
            const streakElement = document.getElementById('streak');
            const showHintBtn = document.getElementById('showHintBtn');
            const hideHintBtn = document.getElementById('hideHintBtn');
            const hintContainer = document.getElementById('hintContainer');
            const examplesContainer = document.getElementById('examplesContainer');
            const pronounceBtn = document.getElementById('pronounceBtn');
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let streak = 0;
            let currentCharIndex = 0;
            let characters = [];
            // Speech synthesis
            const synth = window.speechSynthesis || null;
            
            // Character data by level
            const characterData = {
                beginner: [
                    { char: '我', pinyin: 'wǒ', meaning: 'I, me' },
                    { char: '你', pinyin: 'nǐ', meaning: 'you' },
                    { char: '他', pinyin: 'tā', meaning: 'he, him' },
                    { char: '她', pinyin: 'tā', meaning: 'she, her' },
                    { char: '好', pinyin: 'hǎo', meaning: 'good, well' },
                    { char: '是', pinyin: 'shì', meaning: 'to be, is, am, are' },
                    { char: '不', pinyin: 'bù', meaning: 'no, not' },
                    { char: '人', pinyin: 'rén', meaning: 'person, people' },
                    { char: '们', pinyin: 'men', meaning: 'plural marker' },
                    { char: '一', pinyin: 'yī', meaning: 'one' },
                    { char: '二', pinyin: 'èr', meaning: 'two' },
                    { char: '三', pinyin: 'sān', meaning: 'three' },
                    { char: '四', pinyin: 'sì', meaning: 'four' },
                    { char: '五', pinyin: 'wǔ', meaning: 'five' },
                    { char: '六', pinyin: 'liù', meaning: 'six' },
                    { char: '七', pinyin: 'qī', meaning: 'seven' },
                    { char: '八', pinyin: 'bā', meaning: 'eight' },
                    { char: '九', pinyin: 'jiǔ', meaning: 'nine' },
                    { char: '十', pinyin: 'shí', meaning: 'ten' },
                    { char: '中', pinyin: 'zhōng', meaning: 'middle, center, China' }
                ],
                elementary: [
                    { char: '时', pinyin: 'shí', meaning: 'time, hour' },
                    { char: '间', pinyin: 'jiān', meaning: 'space, between' },
                    { char: '年', pinyin: 'nián', meaning: 'year' },
                    { char: '月', pinyin: 'yuè', meaning: 'month, moon' },
                    { char: '日', pinyin: 'rì', meaning: 'day, sun' },
                    { char: '今', pinyin: 'jīn', meaning: 'now, current' },
                    { char: '明', pinyin: 'míng', meaning: 'bright, clear' },
                    { char: '昨', pinyin: 'zuó', meaning: 'yesterday' },
                    { char: '天', pinyin: 'tiān', meaning: 'day, sky, heaven' },
                    { char: '下', pinyin: 'xià', meaning: 'below, down, next' },
                    { char: '上', pinyin: 'shàng', meaning: 'up, on, above' },
                    { char: '前', pinyin: 'qián', meaning: 'before, front' },
                    { char: '后', pinyin: 'hòu', meaning: 'after, behind' },
                    { char: '左', pinyin: 'zuǒ', meaning: 'left' },
                    { char: '右', pinyin: 'yòu', meaning: 'right' },
                    { char: '大', pinyin: 'dà', meaning: 'big, large' },
                    { char: '小', pinyin: 'xiǎo', meaning: 'small, little' },
                    { char: '多', pinyin: 'duō', meaning: 'many, much' },
                    { char: '少', pinyin: 'shǎo', meaning: 'few, little' },
                    { char: '水', pinyin: 'shuǐ', meaning: 'water' }
                ],
                intermediate: [
                    { char: '学', pinyin: 'xué', meaning: 'to learn, study' },
                    { char: '生', pinyin: 'shēng', meaning: 'to be born, life' },
                    { char: '校', pinyin: 'xiào', meaning: 'school' },
                    { char: '教', pinyin: 'jiāo', meaning: 'to teach' },
                    { char: '师', pinyin: 'shī', meaning: 'teacher, master' },
                    { char: '语', pinyin: 'yǔ', meaning: 'language' },
                    { char: '文', pinyin: 'wén', meaning: 'language, culture, writing' },
                    { char: '字', pinyin: 'zì', meaning: 'character, word' },
                    { char: '工', pinyin: 'gōng', meaning: 'work' },
                    { char: '作', pinyin: 'zuò', meaning: 'to do, to make' },
                    { char: '开', pinyin: 'kāi', meaning: 'to open' },
                    { char: '始', pinyin: 'shǐ', meaning: 'to begin' },
                    { char: '结', pinyin: 'jié', meaning: 'to tie, to bind' },
                    { char: '束', pinyin: 'shù', meaning: 'to bind, bundle' },
                    { char: '朋', pinyin: 'péng', meaning: 'friend' },
                    { char: '友', pinyin: 'yǒu', meaning: 'friend' },
                    { char: '家', pinyin: 'jiā', meaning: 'home, family' },
                    { char: '国', pinyin: 'guó', meaning: 'country, nation' },
                    { char: '城', pinyin: 'chéng', meaning: 'city, town' },
                    { char: '市', pinyin: 'shì', meaning: 'market, city' }
                ],
                advanced: [
                    { char: '经', pinyin: 'jīng', meaning: 'classics, scripture, to pass through' },
                    { char: '济', pinyin: 'jì', meaning: 'economy, to cross a river' },
                    { char: '政', pinyin: 'zhèng', meaning: 'government, politics' },
                    { char: '治', pinyin: 'zhì', meaning: 'to govern, to manage' },
                    { char: '法', pinyin: 'fǎ', meaning: 'law, method' },
                    { char: '律', pinyin: 'lǜ', meaning: 'law, rule' },
                    { char: '责', pinyin: 'zé', meaning: 'responsibility, to blame' },
                    { char: '任', pinyin: 'rèn', meaning: 'to appoint, duty' },
                    { char: '科', pinyin: 'kē', meaning: 'subject, science, branch' },
                    { char: '技', pinyin: 'jì', meaning: 'skill, technique' },
                    { char: '术', pinyin: 'shù', meaning: 'art, technique, method' },
                    { char: '环', pinyin: 'huán', meaning: 'ring, circle, to surround' },
                    { char: '境', pinyin: 'jìng', meaning: 'border, boundary, environment' },
                    { char: '保', pinyin: 'bǎo', meaning: 'to protect, to ensure' },
                    { char: '护', pinyin: 'hù', meaning: 'to protect, to guard' },
                    { char: '发', pinyin: 'fā', meaning: 'to send out, to develop' },
                    { char: '展', pinyin: 'zhǎn', meaning: 'to unfold, to expand' },
                    { char: '创', pinyin: 'chuàng', meaning: 'to begin, to initiate' },
                    { char: '新', pinyin: 'xīn', meaning: 'new' },
                    { char: '未', pinyin: 'wèi', meaning: 'not yet, haven\'t' }
                ]
            };
            
            // Initialize canvas
            function initCanvas() {
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                ctx.lineWidth = 8;
                ctx.strokeStyle = '#000';
                clearCanvas();
                
                // Initialize speech synthesis safely
                if (window.speechSynthesis && typeof window.speechSynthesis.onvoiceschanged !== 'undefined') {
                    window.speechSynthesis.onvoiceschanged = () => {
                        // Get voices when they're loaded
                        const voices = window.speechSynthesis.getVoices();
                        // Log available voices for debugging
                        console.log("Available voices:", voices.map(v => `${v.name} (${v.lang})`).join(', '));
                    };
                }
            }
            
            // Clear the canvas
            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            
            // Draw on canvas
            function draw(e) {
                if (!isDrawing) return;
                
                // Get correct coordinates for both mouse and touch
                let x, y;
                if (e.type === 'mousemove') {
                    x = e.offsetX;
                    y = e.offsetY;
                } else if (e.type === 'touchmove') {
                    const rect = canvas.getBoundingClientRect();
                    x = e.touches[0].clientX - rect.left;
                    y = e.touches[0].clientY - rect.top;
                    e.preventDefault();
                }
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                [lastX, lastY] = [x, y];
            }
            
            // Start drawing
            function startDrawing(e) {
                isDrawing = true;
                
                // Get correct coordinates for both mouse and touch
                if (e.type === 'mousedown') {
                    lastX = e.offsetX;
                    lastY = e.offsetY;
                } else if (e.type === 'touchstart') {
                    const rect = canvas.getBoundingClientRect();
                    lastX = e.touches[0].clientX - rect.left;
                    lastY = e.touches[0].clientY - rect.top;
                    e.preventDefault();
                }
            }
            
            // Stop drawing
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Load characters based on level
            function loadCharacters() {
                const level = levelSelect.value;
                characters = [...characterData[level]];
                shuffleArray(characters);
                currentCharIndex = 0;
                streak = 0;
                streakElement.textContent = streak;
                updateProgressBar();
                displayCharacter();
                updateExamplesDisplay();
            }
            
            // Display current character
            function displayCharacter() {
                const current = characters[currentCharIndex];
                characterDisplay.textContent = current.char;
                pinyinDisplay.textContent = current.pinyin;
                meaningDisplay.textContent = current.meaning;
                
                // Update hint container character
                hintContainer.querySelector('.character-display').textContent = current.char;
                
                // Auto-pronounce when displaying a new character
                // Only if speech synthesis is available
                if (window.speechSynthesis) {
                    setTimeout(() => {
                        pronounceCurrentCharacter();
                    }, 500);
                }
            }
            
            // Shuffle array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i +.1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }
            
            // Progress to next character
            function nextCharacter() {
                clearCanvas();
                currentCharIndex = (currentCharIndex + 1) % characters.length;
                updateProgressBar();
                displayCharacter();
                
                // Hide hint if it was showing
                hideHint();
            }
            
            // Update progress bar
            function updateProgressBar() {
                const percentage = ((currentCharIndex + 1) / characters.length) * 100;
                progressBar.style.width = `${percentage}%`;
            }
            
            // Update examples display
            function updateExamplesDisplay() {
                examplesContainer.innerHTML = '';
                
                // Add 5 random examples from the current level
                const shuffled = [...characters].sort(() => 0.5 - Math.random());
                const selected = shuffled.slice(0, 5);
                
                selected.forEach(char => {
                    const exampleDiv = document.createElement('div');
                    exampleDiv.className = 'example-character';
                    exampleDiv.innerHTML = `
                        <span>${char.char}</span>
                        <span>${char.pinyin}</span>
                    `;
                    
                    exampleDiv.addEventListener('click', () => {
                        // Find the index of this character in the main array
                        const index = characters.findIndex(c => c.char === char.char);
                        if (index !== -1) {
                            currentCharIndex = index;
                            displayCharacter();
                            updateProgressBar();
                            clearCanvas();
                        }
                    });
                    
                    // Add pronunciation on example characters too
                    // Only if speech synthesis is available
                    if (window.speechSynthesis) {
                        const pronunciationIcon = document.createElement('i');
                        pronunciationIcon.className = 'fas fa-volume-up';
                        pronunciationIcon.style.marginLeft = '5px';
                        pronunciationIcon.style.cursor = 'pointer';
                        pronunciationIcon.style.color = '#4CAF50';
                        pronunciationIcon.addEventListener('click', (e) => {
                            e.stopPropagation();
                            pronounceCharacter(char.char, char.pinyin);
                        });
                        exampleDiv.appendChild(pronunciationIcon);
                    }
                    
                    examplesContainer.appendChild(exampleDiv);
                });
            }
            
            // Show hint
            function showHint() {
                hintContainer.style.display = 'block';
                showHintBtn.style.display = 'none';
                hideHintBtn.style.display = 'inline-block';
            }
            
            // Hide hint
            function hideHint() {
                hintContainer.style.display = 'none';
                hideHintBtn.style.display = 'none';
                showHintBtn.style.display = 'inline-block';
            }
            
            // Increment streak
            function incrementStreak() {
                streak++;
                streakElement.textContent = streak;
                
                // Visual feedback for streak
                streakElement.style.color = '#4caf50';
                streakElement.style.fontSize = '20px';
                setTimeout(() => {
                    streakElement.style.color = '';
                    streakElement.style.fontSize = '';
                }, 500);
            }
            
            // Event listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch event support
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            
            // Pronunciation functions
            function pronounceCurrentCharacter() {
                // Check if speech synthesis is available
                if (!window.speechSynthesis) {
                    console.warn("Speech synthesis not supported in this browser");
                    alert("Speech synthesis is not supported in your browser");
                    return;
                }
                
                const current = characters[currentCharIndex];
                pronounceCharacter(current.char, current.pinyin);
            }
            
            function pronounceCharacter(character, pinyin) {
                // Check if speech synthesis is available
                if (!window.speechSynthesis) {
                    console.warn("Speech synthesis not supported in this browser");
                    return;
                }
                
                try {
                    // Cancel any ongoing speech first (important for Windows)
                    window.speechSynthesis.cancel();
                    
                    // First try to use voices that can handle Chinese
                    let utterance = new SpeechSynthesisUtterance(character);
                    
                    // Try to find the Google 普通话（中国大陆）voice specifically
                    const voices = window.speechSynthesis.getVoices();
                    let targetVoice = null;
                    
                    if (voices && voices.length > 0) {
                        // Look specifically for Google 普通话（中国大陆）
                        targetVoice = voices.find(voice => 
                            voice.name === "Google 普通话（中国大陆）" && voice.lang === "zh-CN"
                        );
                        
                        // If not found, try any Google Chinese voice
                        if (!targetVoice) {
                            targetVoice = voices.find(voice => 
                                voice.name && voice.name.includes("Google") && 
                                voice.lang === "zh-CN"
                            );
                        }
                        
                        // If still not found, try any Chinese voice
                        if (!targetVoice) {
                            targetVoice = voices.find(voice => 
                                voice.lang && (
                                    voice.lang.includes('zh') || 
                                    voice.lang.includes('cmn') || 
                                    (voice.name && (
                                        voice.name.includes('Chinese') || 
                                        voice.name.includes('Mandarin') ||
                                        voice.name.includes('普通话')
                                    ))
                                )
                            );
                        }
                    }
                    
                    // Log available voices to help with debugging
                    console.log("Available voices:", voices.map(v => `${v.name} (${v.lang})`));
                    
                    if (targetVoice) {
                        console.log("Using voice:", targetVoice.name, targetVoice.lang);
                        utterance.voice = targetVoice;
                        utterance.lang = targetVoice.lang;
                    } else {
                        // If no Chinese voice is available, we'll use any available voice
                        // but set a Chinese language tag to improve pronunciation
                        console.log("No Chinese voice found, using default with zh-CN language");
                        utterance.lang = 'zh-CN';
                    }
                    
                    // Make it speak a bit slower for learning purposes
                    utterance.rate = 0.8;
                    
                    // Add a visual feedback while speaking
                    const originalColor = characterDisplay.style.color || '#333';
                    characterDisplay.style.color = '#d62828';
                    
                    utterance.onend = () => {
                        characterDisplay.style.color = originalColor;
                        // Reset the speech synthesis system (helps with Windows issues)
                        setTimeout(() => {
                            window.speechSynthesis.cancel();
                        }, 100);
                    };
                    
                    window.speechSynthesis.speak(utterance);
                    
                    // Windows fix: if speech doesn't start within a reasonable time, reset it
                    setTimeout(() => {
                        if (window.speechSynthesis.speaking) {
                            window.speechSynthesis.pause();
                            window.speechSynthesis.resume();
                        }
                    }, 1000);
                    
                } catch (error) {
                    console.error("Error with speech synthesis:", error);
                    // Try to reset the speech system on error
                    try {
                        window.speechSynthesis.cancel();
                    } catch (e) {
                        console.error("Failed to reset speech synthesis:", e);
                    }
                }
            }
            
            clearBtn.addEventListener('click', clearCanvas);
            nextBtn.addEventListener('click', () => {
                incrementStreak();
                nextCharacter();
            });
            
            levelSelect.addEventListener('change', loadCharacters);
            
            showHintBtn.addEventListener('click', showHint);
            hideHintBtn.addEventListener('click', hideHint);
            pronounceBtn.addEventListener('click', pronounceCurrentCharacter);
            
            // Initialize the app
            initCanvas();
            loadCharacters();
        });
    </script>
</body>
</html>
